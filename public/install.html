<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Installation Guide - FinBuddy</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .card { 
            background: rgba(255,255,255,0.1); 
            backdrop-filter: blur(10px);
            padding: 30px; 
            margin: 20px 0; 
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .install-button { 
            background: #10b981; 
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .install-button:hover { 
            background: #059669; 
            transform: translateY(-2px);
        }
        .install-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .status { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            border-left: 4px solid;
        }
        .success { background: rgba(16, 185, 129, 0.2); border-color: #10b981; }
        .warning { background: rgba(245, 158, 11, 0.2); border-color: #f59e0b; }
        .error { background: rgba(239, 68, 68, 0.2); border-color: #ef4444; }
        .info { background: rgba(59, 130, 246, 0.2); border-color: #3b82f6; }
        .browser-instructions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .browser-card {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        .browser-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }
        .back-link {
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            display: inline-block;
            margin: 20px 0;
        }
        .back-link:hover {
            background: rgba(255,255,255,0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± Install FinBuddy App</h1>
        <p>Transform your browser experience into a native-like app!</p>
        
        <div class="card">
            <h2>üöÄ Quick Install</h2>
            <button id="installButton" class="install-button">
                üì• Install FinBuddy
            </button>
            <div id="installStatus"></div>
            
            <div style="margin-top: 20px;">
                <small>Don't see the install button? Try the manual instructions below.</small>
            </div>
        </div>
        
        <div class="card">
            <h2>üìã Manual Installation Instructions</h2>
            <div class="browser-instructions">
                <div class="browser-card">
                    <div class="browser-icon">üåê</div>
                    <h3>Chrome/Edge (Desktop)</h3>
                    <p>1. Look for the install icon (‚äï) in the address bar<br>
                    2. Click it and select "Install"<br>
                    3. Or go to Settings ‚Üí Install FinBuddy</p>
                </div>
                
                <div class="browser-card">
                    <div class="browser-icon">üì±</div>
                    <h3>Chrome (Android)</h3>
                    <p>1. Tap the menu (‚ãÆ) button<br>
                    2. Select "Add to Home Screen"<br>
                    3. Confirm the installation</p>
                </div>
                
                <div class="browser-card">
                    <div class="browser-icon">üçé</div>
                    <h3>Safari (iOS)</h3>
                    <p>1. Tap the Share button (‚éã)<br>
                    2. Select "Add to Home Screen"<br>
                    3. Customize name and tap "Add"</p>
                </div>
                
                <div class="browser-card">
                    <div class="browser-icon">ü¶ä</div>
                    <h3>Firefox</h3>
                    <p>PWA support limited.<br>
                    Consider using Chrome or Edge<br>
                    for the best experience.</p>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>‚ú® Benefits of Installing</h2>
            <ul>
                <li>üöÄ <strong>Faster loading</strong> - Works offline</li>
                <li>üì± <strong>Native feel</strong> - No browser UI</li>
                <li>üè† <strong>Home screen icon</strong> - Easy access</li>
                <li>üîî <strong>Notifications</strong> - Stay updated</li>
                <li>üíæ <strong>Offline sync</strong> - Track expenses anywhere</li>
            </ul>
        </div>
        
        <div class="card">
            <h2>üîß Troubleshooting</h2>
            <div id="diagnostics"></div>
            <button onclick="runDiagnostics()" style="background: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
                Run Diagnostics
            </button>
        </div>
        
        <a href="/" class="back-link">‚Üê Back to FinBuddy App</a>
    </div>

    <script>
        let deferredPrompt = null;
        
        // Listen for install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('Install prompt available');
            e.preventDefault();
            deferredPrompt = e;
            
            const button = document.getElementById('installButton');
            button.disabled = false;
            button.innerHTML = 'üì• Install FinBuddy';
            
            document.getElementById('installStatus').innerHTML = 
                '<div class="status success">‚úÖ Ready to install! Click the button above.</div>';
        });
        
        // Handle install button click
        document.getElementById('installButton').addEventListener('click', async () => {
            const button = document.getElementById('installButton');
            const status = document.getElementById('installStatus');
            
            if (!deferredPrompt) {
                status.innerHTML = '<div class="status warning">‚ö†Ô∏è Automatic install not available. Please use manual instructions above.</div>';
                return;
            }
            
            button.disabled = true;
            button.innerHTML = '‚è≥ Installing...';
            
            try {
                deferredPrompt.prompt();
                const result = await deferredPrompt.userChoice;
                
                if (result.outcome === 'accepted') {
                    status.innerHTML = '<div class="status success">üéâ Successfully installed! You can now find FinBuddy on your device.</div>';
                    button.innerHTML = '‚úÖ Installed';
                } else {
                    status.innerHTML = '<div class="status info">‚ÑπÔ∏è Installation cancelled. You can install later using the manual methods.</div>';
                    button.disabled = false;
                    button.innerHTML = 'üì• Install FinBuddy';
                }
            } catch (error) {
                console.error('Install failed:', error);
                status.innerHTML = '<div class="status error">‚ùå Installation failed. Please try manual installation.</div>';
                button.disabled = false;
                button.innerHTML = 'üì• Install FinBuddy';
            }
            
            deferredPrompt = null;
        });
        
        // Check if already installed
        window.addEventListener('appinstalled', () => {
            document.getElementById('installStatus').innerHTML = 
                '<div class="status success">üéâ App installed successfully!</div>';
        });
        
        // Check if running as PWA
        if (window.matchMedia('(display-mode: standalone)').matches) {
            document.getElementById('installStatus').innerHTML = 
                '<div class="status info">üì± You\'re already running FinBuddy as an installed app!</div>';
            document.getElementById('installButton').style.display = 'none';
        }
        
        // Diagnostics function
        function runDiagnostics() {
            const diagnostics = document.getElementById('diagnostics');
            let checks = [];
            
            // HTTPS check
            if (location.protocol === 'https:' || location.hostname === 'localhost') {
                checks.push('<div class="status success">‚úÖ HTTPS requirement met</div>');
            } else {
                checks.push('<div class="status error">‚ùå HTTPS required (except localhost)</div>');
            }
            
            // Service Worker
            if ('serviceWorker' in navigator) {
                checks.push('<div class="status success">‚úÖ Service Worker supported</div>');
            } else {
                checks.push('<div class="status error">‚ùå Service Worker not supported</div>');
            }
            
            // Manifest
            fetch('/manifest.json')
                .then(response => response.json())
                .then(manifest => {
                    checks.push('<div class="status success">‚úÖ Manifest accessible</div>');
                    checks.push(`<div class="status info">‚ÑπÔ∏è App name: ${manifest.name}</div>`);
                    diagnostics.innerHTML = checks.join('');
                })
                .catch(() => {
                    checks.push('<div class="status error">‚ùå Manifest not accessible</div>');
                    diagnostics.innerHTML = checks.join('');
                });
            
            // Browser info
            const userAgent = navigator.userAgent;
            if (userAgent.includes('Chrome')) {
                checks.push('<div class="status success">‚úÖ Chrome detected - PWA supported</div>');
            } else if (userAgent.includes('Edge')) {
                checks.push('<div class="status success">‚úÖ Edge detected - PWA supported</div>');
            } else if (userAgent.includes('Safari')) {
                checks.push('<div class="status warning">‚ö†Ô∏è Safari - Limited PWA support</div>');
            } else if (userAgent.includes('Firefox')) {
                checks.push('<div class="status warning">‚ö†Ô∏è Firefox - Limited PWA support</div>');
            }
            
            // Install prompt
            if (deferredPrompt) {
                checks.push('<div class="status success">‚úÖ Install prompt available</div>');
            } else {
                checks.push('<div class="status warning">‚ö†Ô∏è Install prompt not triggered</div>');
            }
            
            diagnostics.innerHTML = checks.join('');
        }
        
        // Run initial diagnostics
        setTimeout(runDiagnostics, 1000);
    </script>
</body>
</html>
