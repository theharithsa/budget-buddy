<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - FinBuddy Developer Docs</title>
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Titillium Web', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            color: #000;
            background: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 3px solid #000;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #000;
        }

        .back-btn {
            background: #000;
            color: #fff;
            padding: 0.8rem 1.5rem;
            text-decoration: none;
            border-radius: 4px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid #000;
        }

        .back-btn:hover {
            background: #fff;
            color: #000;
            box-shadow: 4px 4px 0 #000;
            transform: translate(-2px, -2px);
        }

        .section {
            margin: 3rem 0;
            padding: 2rem;
            border: 2px solid #000;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .section h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #000;
        }

        .section h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 2rem 0 1rem 0;
            color: #000;
        }

        .code-block {
            background: #000;
            color: #fff;
            padding: 1.5rem;
            border-radius: 6px;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            border: 2px solid #333;
        }

        .api-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .api-card {
            background: #fff;
            border: 2px solid #000;
            padding: 1.5rem;
            border-radius: 6px;
        }

        .api-card h4 {
            font-weight: 700;
            margin-bottom: 1rem;
            color: #000;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .method-badge {
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #fff;
        }

        .get-badge { background: #28a745; }
        .post-badge { background: #007bff; }
        .put-badge { background: #ffc107; color: #000; }
        .delete-badge { background: #dc3545; }

        .params-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            background: #fff;
            border: 1px solid #000;
        }

        .params-table th,
        .params-table td {
            border: 1px solid #000;
            padding: 0.8rem;
            text-align: left;
        }

        .params-table th {
            background: #000;
            color: #fff;
            font-weight: 600;
        }

        .params-table td code {
            background: #f0f0f0;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .api-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>API Reference</h1>
            <a href="index.html" class="back-btn">‚Üê Back to Docs</a>
        </div>

        <!-- Overview -->
        <section class="section">
            <h2>üîå FinBuddy API Overview</h2>
            <p>Comprehensive API reference for FinBuddy's Firebase-based backend, including Firestore operations, authentication, storage, and KautilyaAI Co-Pilot integration.</p>
            
            <div class="code-block">
                <pre><code>// Base Configuration
const API_BASE = 'https://your-project.firebaseapp.com';
const FUNCTIONS_BASE = 'https://us-central1-your-project.cloudfunctions.net';

// Authentication Required for All Operations
headers: {
  'Authorization': `Bearer ${userToken}`,
  'Content-Type': 'application/json'
}</code></pre>
            </div>
        </section>

        <!-- Authentication API -->
        <section class="section">
            <h2>üîê Authentication API</h2>
            
            <div class="api-grid">
                <div class="api-card">
                    <h4>
                        <span class="method-badge post-badge">POST</span>
                        Google Sign In
                    </h4>
                    <p><strong>Endpoint:</strong> Firebase Auth SDK</p>
                    <p><strong>Purpose:</strong> Authenticate user with Google OAuth</p>
                    
                    <h5>Implementation:</h5>
                    <div class="code-block">
                        <pre><code>// signInWithGoogle
import { signInWithPopup, GoogleAuthProvider } from 'firebase/auth';

const signInWithGoogle = async () => {
  try {
    const result = await signInWithPopup(auth, googleProvider);
    const user = result.user;
    return { success: true, user };
  } catch (error) {
    return { success: false, error: error.message };
  }
};</code></pre>
                    </div>
                </div>

                <div class="api-card">
                    <h4>
                        <span class="method-badge post-badge">POST</span>
                        Sign Out
                    </h4>
                    <p><strong>Endpoint:</strong> Firebase Auth SDK</p>
                    <p><strong>Purpose:</strong> Sign out current user</p>
                    
                    <h5>Implementation:</h5>
                    <div class="code-block">
                                            <pre><code>// signOut
import { signOut } from 'firebase/auth';

const logout = async () => {
  try {
    await signOut(auth);
    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
};</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Firestore API -->
        <section class="section">
            <h2>üìä Firestore Database API</h2>
            
            <h3>Expense Operations</h3>
            <div class="api-grid">
                <div class="api-card">
                    <h4>
                        <span class="method-badge get-badge">GET</span>
                        Get Expenses
                    </h4>
                    <p><strong>Collection:</strong> <code>/users/{userId}/expenses</code></p>
                    <p><strong>Purpose:</strong> Retrieve user expenses with real-time updates</p>
                    
                    <h5>Parameters:</h5>
                    <table class="params-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>userId</code></td>
                                <td>string</td>
                                <td>Firebase Auth user ID</td>
                            </tr>
                            <tr>
                                <td><code>orderBy</code></td>
                                <td>string</td>
                                <td>Sort field (default: 'date')</td>
                            </tr>
                            <tr>
                                <td><code>limit</code></td>
                                <td>number</td>
                                <td>Optional limit for pagination</td>
                            </tr>
                        </tbody>
                    </table>

                    <h5>Implementation:</h5>
                    <div class="code-block">
                                            <pre><code>// Real-time expense listener
const getExpenses = (userId: string, callback: (expenses: Expense[]) => void) => {
  const unsubscribe = onSnapshot(
    query(
      collection(db, 'users', userId, 'expenses'),
      orderBy('date', 'desc')
    ),
    (snapshot) => {
      const expenses = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      })) as Expense[];
      callback(expenses);
    }
  );
  return unsubscribe;
};</code></pre>
                    </div>
                </div>

                <div class="api-card">
                    <h4>
                        <span class="method-badge post-badge">POST</span>
                        Create Expense
                    </h4>
                    <p><strong>Collection:</strong> <code>/users/{userId}/expenses</code></p>
                    <p><strong>Purpose:</strong> Add new expense to user's collection</p>
                    
                    <h5>Request Body:</h5>
                    <div class="code-block">
                                            <pre><code>{
  "amount": 25.50,
  "category": "Food",
  "description": "Lunch at restaurant",
  "date": "2024-01-15",
  "peopleIds": ["person_id_1"],
  "receiptUrl": "optional_receipt_url"
}</code></pre>
                    </div>

                    <h5>Implementation:</h5>
                    <div class="code-block">
                                            <pre><code>// Add expense
const addExpense = async (userId: string, expense: Omit&lt;Expense, 'id'&gt;) => {
  try {
    const docRef = await addDoc(
      collection(db, 'users', userId, 'expenses'),
      {
        ...expense,
        createdAt: new Date().toISOString(),
        userId
      }
    );
    return { success: true, id: docRef.id };
  } catch (error) {
    return { success: false, error: error.message };
  }
};</code></pre>
                    </div>
                </div>

                <div class="api-card">
                    <h4>
                        <span class="method-badge put-badge">PUT</span>
                        Update Expense
                    </h4>
                    <p><strong>Document:</strong> <code>/users/{userId}/expenses/{expenseId}</code></p>
                    <p><strong>Purpose:</strong> Update existing expense</p>
                    
                    <h5>Implementation:</h5>
                    <div class="code-block">
                                            <pre><code>// Update expense
const updateExpense = async (
  userId: string, 
  expenseId: string, 
  updates: Partial&lt;Expense&gt;
) => {
  try {
    await updateDoc(
      doc(db, 'users', userId, 'expenses', expenseId),
      updates
    );
    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
};</code></pre>
                    </div>
                </div>

                <div class="api-card">
                    <h4>
                        <span class="method-badge delete-badge">DELETE</span>
                        Delete Expense
                    </h4>
                    <p><strong>Document:</strong> <code>/users/{userId}/expenses/{expenseId}</code></p>
                    <p><strong>Purpose:</strong> Remove expense from user's collection</p>
                    
                    <h5>Implementation:</h5>
                    <div class="code-block">
                                            <pre><code>// Delete expense
const deleteExpense = async (userId: string, expenseId: string) => {
  try {
    await deleteDoc(doc(db, 'users', userId, 'expenses', expenseId));
    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
};</code></pre>
                    </div>
                </div>
            </div>

            <h3>Budget Operations</h3>
            <div class="api-grid">
                <div class="api-card">
                    <h4>
                        <span class="method-badge get-badge">GET</span>
                        Get Budgets
                    </h4>
                    <p><strong>Collection:</strong> <code>/users/{userId}/budgets</code></p>
                    <p><strong>Purpose:</strong> Retrieve user budgets</p>
                    
                    <h5>Implementation:</h5>
                    <div class="code-block">
                                            <pre><code>// Real-time budget listener
const getBudgets = (userId: string, callback: (budgets: Budget[]) => void) => {
  const unsubscribe = onSnapshot(
    collection(db, 'users', userId, 'budgets'),
    (snapshot) => {
      const budgets = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      })) as Budget[];
      callback(budgets);
    }
  );
  return unsubscribe;
};</code></pre>
                    </div>
                </div>

                <div class="api-card">
                    <h4>
                        <span class="method-badge post-badge">POST</span>
                        Create Budget
                    </h4>
                    <p><strong>Collection:</strong> <code>/users/{userId}/budgets</code></p>
                    <p><strong>Purpose:</strong> Create new budget</p>
                    
                    <h5>Request Body:</h5>
                    <div class="code-block">
                                            <pre><code>{
  "category": "Food",
  "amount": 500,
  "period": "monthly",
  "startDate": "2024-01-01",
  "isActive": true
}</code></pre>
                    </div>
                </div>
            </div>

            <h3>People Operations</h3>
            <div class="api-grid">
                <div class="api-card">
                    <h4>
                        <span class="method-badge get-badge">GET</span>
                        Get Custom People
                    </h4>
                    <p><strong>Collection:</strong> <code>/users/{userId}/customPeople</code></p>
                    <p><strong>Purpose:</strong> Retrieve user's custom people</p>
                    
                    <h5>Implementation:</h5>
                    <div class="code-block">
                                            <pre><code>// Get custom people
const getCustomPeople = (userId: string, callback: (people: Person[]) => void) => {
  const unsubscribe = onSnapshot(
    collection(db, 'users', userId, 'customPeople'),
    (snapshot) => {
      const people = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      })) as Person[];
      callback(people);
    }
  );
  return unsubscribe;
};</code></pre>
                    </div>
                </div>

                <div class="api-card">
                    <h4>
                        <span class="method-badge get-badge">GET</span>
                        Get Public People
                    </h4>
                    <p><strong>Collection:</strong> <code>/publicPeople</code></p>
                    <p><strong>Purpose:</strong> Retrieve shared public people</p>
                    
                    <h5>Implementation:</h5>
                    <div class="code-block">
                                            <pre><code>// Get public people
const getPublicPeople = (callback: (people: Person[]) => void) => {
  const unsubscribe = onSnapshot(
    collection(db, 'publicPeople'),
    (snapshot) => {
      const people = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      })) as Person[];
      callback(people);
    }
  );
  return unsubscribe;
};</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Storage API -->
        <section class="section">
            <h2>üìÅ Firebase Storage API</h2>
            
            <div class="api-grid">
                <div class="api-card">
                    <h4>
                        <span class="method-badge post-badge">POST</span>
                        Upload Receipt
                    </h4>
                    <p><strong>Path:</strong> <code>/receipts/{userId}/{filename}</code></p>
                    <p><strong>Purpose:</strong> Upload receipt image for expense</p>
                    
                    <h5>Implementation:</h5>
                    <div class="code-block">
                                            <pre><code>// Upload receipt
const uploadReceipt = async (userId: string, file: File) => {
  try {
    const fileName = `${Date.now()}_${file.name}`;
    const storageRef = ref(storage, `receipts/${userId}/${fileName}`);
    
    const snapshot = await uploadBytes(storageRef, file);
    const downloadURL = await getDownloadURL(snapshot.ref);
    
    return { success: true, url: downloadURL };
  } catch (error) {
    return { success: false, error: error.message };
  }
};</code></pre>
                    </div>
                </div>

                <div class="api-card">
                    <h4>
                        <span class="method-badge delete-badge">DELETE</span>
                        Delete Receipt
                    </h4>
                    <p><strong>Path:</strong> <code>/receipts/{userId}/{filename}</code></p>
                    <p><strong>Purpose:</strong> Remove receipt image from storage</p>
                    
                    <h5>Implementation:</h5>
                    <div class="code-block">
                                            <pre><code>// Delete receipt
const deleteReceipt = async (receiptUrl: string) => {
  try {
    const storageRef = ref(storage, receiptUrl);
    await deleteObject(storageRef);
    return { success: true };
  } catch (error) {
    return { success: false, error: error.message };
  }
};</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Firebase Functions API -->
        <section class="section">
            <h2>‚ö° Firebase Functions API</h2>
            
            <div class="api-grid">
                <div class="api-card">
                    <h4>
                        <span class="method-badge post-badge">POST</span>
                        KautilyaAI Chat
                    </h4>
                    <p><strong>Function:</strong> <code>chatWithGemini</code></p>
                    <p><strong>Purpose:</strong> Process AI chat messages with financial context</p>
                    
                    <h5>Request Body:</h5>
                    <div class="code-block">
                                            <pre><code>{
  "message": "Add a $50 grocery expense for today",
  "context": {
    "recentExpenses": [...],
    "activeBudgets": [...],
    "customPeople": [...],
    "publicPeople": [...]
  },
  "sessionId": "session_uuid"
}</code></pre>
                    </div>

                    <h5>Response:</h5>
                    <div class="code-block">
                                            <pre><code>{
  "message": "I've added your $50 grocery expense for today...",
  "executedActions": [
    {
      "type": "create_expense",
      "success": true,
      "summary": "Added $50 grocery expense",
      "data": { "id": "expense_id" }
    }
  ],
  "timestamp": "2024-01-15T10:30:00Z",
  "sessionId": "session_uuid"
}</code></pre>
                    </div>

                    <h5>Implementation:</h5>
                    <div class="code-block">
                                            <pre><code>// Call KautilyaAI function
const chatWithAI = async (message: string, context: any) => {
  try {
    const chatWithGemini = httpsCallable(functions, 'chatWithGemini');
    const result = await chatWithGemini({
      message,
      context,
      sessionId: currentSessionId
    });
    return { success: true, data: result.data };
  } catch (error) {
    return { success: false, error: error.message };
  }
};</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Error Handling -->
        <section class="section">
            <h2>‚ö†Ô∏è Error Handling</h2>
            
            <h3>Common Error Responses</h3>
            <div class="code-block">
                                    <pre><code>// Authentication Error
{
  "success": false,
  "error": "User not authenticated",
  "code": "auth/unauthenticated"
}

// Permission Error
{
  "success": false,
  "error": "Missing or insufficient permissions",
  "code": "firestore/permission-denied"
}

// Network Error
{
  "success": false,
  "error": "Network request failed",
  "code": "network/unavailable"
}

// Validation Error
{
  "success": false,
  "error": "Invalid expense data",
  "code": "validation/invalid-data",
  "details": {
    "amount": "Amount must be greater than 0"
  }
}</code></pre>
            </div>

            <h3>Error Handling Pattern</h3>
            <div class="code-block">
                                    <pre><code>// Standard error handling pattern
const handleApiCall = async (apiFunction: () => Promise&lt;any&gt;) => {
  try {
    const result = await apiFunction();
    if (result.success) {
      toast.success("Operation completed successfully");
      return result.data;
    } else {
      toast.error(result.error || "Operation failed");
      return null;
    }
  } catch (error) {
    console.error('API call failed:', error);
    toast.error("An unexpected error occurred");
    return null;
  }
};</code></pre>
            </div>
        </section>

        <!-- Rate Limits -->
        <section class="section">
            <h2>üö¶ Rate Limits & Quotas</h2>
            
            <div class="api-grid">
                <div class="api-card">
                    <h4>Firestore Limits</h4>
                    <ul>
                        <li><strong>Reads:</strong> 20,000/day (free tier)</li>
                        <li><strong>Writes:</strong> 20,000/day (free tier)</li>
                        <li><strong>Deletes:</strong> 20,000/day (free tier)</li>
                        <li><strong>Document Size:</strong> 1 MB max</li>
                    </ul>
                </div>

                <div class="api-card">
                    <h4>Storage Limits</h4>
                    <ul>
                        <li><strong>Upload Size:</strong> 5 MB per file</li>
                        <li><strong>Storage:</strong> 5 GB (free tier)</li>
                        <li><strong>Downloads:</strong> 1 GB/day (free tier)</li>
                        <li><strong>Operations:</strong> 20,000/day (free tier)</li>
                    </ul>
                </div>

                <div class="api-card">
                    <h4>Functions Limits</h4>
                    <ul>
                        <li><strong>Invocations:</strong> 125,000/month (free tier)</li>
                        <li><strong>Compute Time:</strong> 40,000 GB-seconds/month</li>
                        <li><strong>Timeout:</strong> 540 seconds max</li>
                        <li><strong>Memory:</strong> 1 GiB max</li>
                    </ul>
                </div>

                <div class="api-card">
                    <h4>AI Processing Limits</h4>
                    <ul>
                        <li><strong>Requests:</strong> Rate limited per user</li>
                        <li><strong>Context Size:</strong> Limited to prevent token overflow</li>
                        <li><strong>Response Time:</strong> 30 seconds typical</li>
                        <li><strong>Concurrent:</strong> 10 requests per user</li>
                    </ul>
                </div>
            </div>
        </section>

        <footer style="text-align: center; margin-top: 4rem; padding-top: 2rem; border-top: 2px solid #000; color: #666;">
            <p><strong>FinBuddy v2.7.0</strong> - API Reference Documentation</p>
            <p>Complete Firebase backend API with KautilyaAI integration</p>
        </footer>
    </div>
</body>
</html>
