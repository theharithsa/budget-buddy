<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Installation Guide - FinBuddy</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        .hero { text-align: center; margin-bottom: 40px; }
        .hero h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .hero p { font-size: 1.2rem; opacity: 0.9; }
        
        .card { 
            background: rgba(255,255,255,0.1); 
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 30px;
            margin: 20px 0;
        }
        
        .install-methods { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 20px; 
            margin: 30px 0;
        }
        
        .method-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            transition: transform 0.2s;
        }
        .method-card:hover { transform: translateY(-5px); }
        
        .method-icon { font-size: 3rem; margin-bottom: 15px; }
        .method-card h3 { margin-bottom: 15px; color: #fff; }
        .method-card ol { text-align: left; margin: 15px 0; }
        .method-card li { margin: 8px 0; padding-left: 5px; }
        
        .big-button {
            background: #10b981;
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            margin: 10px;
        }
        .big-button:hover { 
            background: #059669; 
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }
        .big-button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .status { 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0;
            border-left: 4px solid;
        }
        .success { background: rgba(16, 185, 129, 0.2); border-color: #10b981; }
        .warning { background: rgba(245, 158, 11, 0.2); border-color: #f59e0b; }
        .error { background: rgba(239, 68, 68, 0.2); border-color: #ef4444; }
        .info { background: rgba(59, 130, 246, 0.2); border-color: #3b82f6; }
        
        .back-link {
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            display: inline-block;
            margin: 20px 0;
            transition: background 0.2s;
        }
        .back-link:hover { background: rgba(255,255,255,0.2); }
        
        .video-placeholder {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <h1>üì± Install FinBuddy App</h1>
            <p>Get the full app experience on your device!</p>
        </div>
        
        <div class="card">
            <h2 style="text-align: center; margin-bottom: 20px;">üöÄ Quick Install</h2>
            <div style="text-align: center;">
                <button id="autoInstall" class="big-button" onclick="tryAutoInstall()">
                    üì• Try Auto Install
                </button>
                <button class="big-button" onclick="showManualInstructions()" style="background: #3b82f6;">
                    üìñ Manual Instructions
                </button>
            </div>
            <div id="installStatus"></div>
        </div>

        <div id="manualInstructions" class="install-methods" style="display: none;">
            <div class="method-card">
                <div class="method-icon">üåê</div>
                <h3>Chrome Desktop</h3>
                <ol>
                    <li>Look for the install icon (‚äï) in the address bar</li>
                    <li>Click it and select "Install"</li>
                    <li>Or click menu (‚ãÆ) ‚Üí "Install FinBuddy"</li>
                </ol>
                <div class="video-placeholder">
                    üé• Install icon appears in address bar
                </div>
            </div>

            <div class="method-card">
                <div class="method-icon">üì±</div>
                <h3>Chrome Android</h3>
                <ol>
                    <li>Tap the menu button (‚ãÆ)</li>
                    <li>Select "Add to Home Screen"</li>
                    <li>Confirm installation</li>
                    <li>App appears on home screen</li>
                </ol>
                <div class="video-placeholder">
                    üé• Menu ‚Üí Add to Home Screen
                </div>
            </div>

            <div class="method-card">
                <div class="method-icon">üçé</div>
                <h3>Safari iOS</h3>
                <ol>
                    <li>Tap the Share button (‚éã)</li>
                    <li>Scroll and tap "Add to Home Screen"</li>
                    <li>Customize name if needed</li>
                    <li>Tap "Add" to confirm</li>
                </ol>
                <div class="video-placeholder">
                    üé• Share ‚Üí Add to Home Screen
                </div>
            </div>

            <div class="method-card">
                <div class="method-icon">‚ö°</div>
                <h3>Edge Desktop</h3>
                <ol>
                    <li>Look for install icon in address bar</li>
                    <li>Or click menu (‚ãØ) ‚Üí "Apps"</li>
                    <li>Select "Install this site as an app"</li>
                    <li>Customize and click "Install"</li>
                </ol>
                <div class="video-placeholder">
                    üé• Apps ‚Üí Install this site
                </div>
            </div>
        </div>

        <div class="card">
            <h2>‚ú® Why Install?</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                <div>
                    <h4>üöÄ Faster Performance</h4>
                    <p>Loads instantly, works offline</p>
                </div>
                <div>
                    <h4>üì± Native Experience</h4>
                    <p>Full screen, no browser UI</p>
                </div>
                <div>
                    <h4>üè† Easy Access</h4>
                    <p>Icon on home screen/desktop</p>
                </div>
                <div>
                    <h4>üîî Notifications</h4>
                    <p>Get expense reminders</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üîß Troubleshooting</h2>
            <div id="diagnostics">
                <p>Having trouble? Let's check what might be wrong:</p>
            </div>
            <button class="big-button" onclick="runDiagnostics()" style="background: #f59e0b;">
                üîç Run Diagnostics
            </button>
        </div>

        <div style="text-align: center;">
            <a href="/" class="back-link">‚Üê Back to FinBuddy</a>
        </div>
    </div>

    <script>
        let deferredPrompt = null;
        let manualShown = false;

        // Listen for install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('üéâ Install prompt available!');
            e.preventDefault();
            deferredPrompt = e;
            
            document.getElementById('installStatus').innerHTML = 
                '<div class="status success">‚úÖ Automatic installation is available! Click "Try Auto Install" above.</div>';
        });

        // Listen for successful installation
        window.addEventListener('appinstalled', () => {
            console.log('üéâ App installed!');
            document.getElementById('installStatus').innerHTML = 
                '<div class="status success">üéâ FinBuddy has been installed successfully! You can now find it on your device.</div>';
        });

        // Check if already running as PWA
        if (window.matchMedia('(display-mode: standalone)').matches) {
            document.getElementById('installStatus').innerHTML = 
                '<div class="status info">üì± You\'re already using FinBuddy as an installed app!</div>';
        }

        async function tryAutoInstall() {
            const status = document.getElementById('installStatus');
            const button = document.getElementById('autoInstall');
            
            if (!deferredPrompt) {
                status.innerHTML = '<div class="status warning">‚ö†Ô∏è Automatic installation not available.<br><br>' +
                    '<strong>This is normal!</strong> Modern browsers are very strict about when they show install prompts.<br><br>' +
                    'üëá <strong>Use the manual instructions below instead</strong> - they work just as well!</div>';
                
                showManualInstructions();
                return;
            }

            button.disabled = true;
            button.innerHTML = '‚è≥ Installing...';

            try {
                deferredPrompt.prompt();
                const result = await deferredPrompt.userChoice;
                
                if (result.outcome === 'accepted') {
                    status.innerHTML = '<div class="status success">‚úÖ Installation started! FinBuddy is being added to your device.</div>';
                } else {
                    status.innerHTML = '<div class="status info">‚ÑπÔ∏è Installation cancelled. You can install manually using the instructions below.</div>';
                    showManualInstructions();
                }
            } catch (error) {
                console.error('Install error:', error);
                status.innerHTML = '<div class="status error">‚ùå Auto install failed. Please use manual instructions below.</div>';
                showManualInstructions();
            } finally {
                deferredPrompt = null;
                button.disabled = false;
                button.innerHTML = 'üì• Try Auto Install';
            }
        }

        function showManualInstructions() {
            document.getElementById('manualInstructions').style.display = 'grid';
            if (!manualShown) {
                document.getElementById('installStatus').innerHTML += 
                    '<div class="status info">üìñ Manual installation instructions are now shown below. These work reliably on all browsers!</div>';
                manualShown = true;
            }
        }

        async function runDiagnostics() {
            const div = document.getElementById('diagnostics');
            div.innerHTML = '<div class="status info">‚è≥ Running diagnostics...</div>';
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            let results = [];
            
            // Check basic requirements
            if (location.protocol === 'https:' || location.hostname === 'localhost') {
                results.push('<div class="status success">‚úÖ HTTPS/localhost requirement met</div>');
            } else {
                results.push('<div class="status error">‚ùå HTTPS required for PWA installation</div>');
            }
            
            // Check Service Worker
            if ('serviceWorker' in navigator) {
                results.push('<div class="status success">‚úÖ Service Worker supported</div>');
                
                try {
                    const registration = await navigator.serviceWorker.getRegistration();
                    if (registration) {
                        results.push('<div class="status success">‚úÖ Service Worker registered</div>');
                    } else {
                        results.push('<div class="status warning">‚ö†Ô∏è Service Worker not registered yet</div>');
                    }
                } catch (error) {
                    results.push('<div class="status error">‚ùå Service Worker error: ' + error.message + '</div>');
                }
            } else {
                results.push('<div class="status error">‚ùå Service Worker not supported</div>');
            }
            
            // Check manifest
            try {
                const response = await fetch('/manifest.json');
                if (response.ok) {
                    results.push('<div class="status success">‚úÖ Manifest accessible</div>');
                } else {
                    results.push('<div class="status error">‚ùå Manifest not accessible</div>');
                }
            } catch (error) {
                results.push('<div class="status error">‚ùå Manifest error: ' + error.message + '</div>');
            }
            
            // Check browser
            const userAgent = navigator.userAgent;
            if (userAgent.includes('Chrome') && !userAgent.includes('Edg')) {
                results.push('<div class="status success">‚úÖ Chrome browser - Full PWA support</div>');
            } else if (userAgent.includes('Edg')) {
                results.push('<div class="status success">‚úÖ Edge browser - Full PWA support</div>');
            } else if (userAgent.includes('Safari')) {
                results.push('<div class="status warning">‚ö†Ô∏è Safari - Use "Add to Home Screen" manually</div>');
            } else if (userAgent.includes('Firefox')) {
                results.push('<div class="status warning">‚ö†Ô∏è Firefox - Limited PWA support</div>');
            }
            
            // Install prompt availability
            if (deferredPrompt) {
                results.push('<div class="status success">‚úÖ Install prompt available</div>');
            } else {
                results.push('<div class="status info">‚ÑπÔ∏è Install prompt not available - this is normal in development</div>');
            }
            
            // Already installed check
            if (window.matchMedia('(display-mode: standalone)').matches) {
                results.push('<div class="status info">üì± App is already installed and running!</div>');
            }
            
            results.push('<div class="status info"><strong>üí° Recommendation:</strong> Use manual installation methods above - they\'re more reliable than auto-install prompts!</div>');
            
            div.innerHTML = results.join('');
        }

        // Auto-show manual instructions after a delay
        setTimeout(() => {
            if (!deferredPrompt) {
                showManualInstructions();
            }
        }, 3000);
    </script>
</body>
</html>
