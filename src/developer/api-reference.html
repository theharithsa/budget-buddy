<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - Budget Buddy Developer Docs</title>
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Titillium Web', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #1a1a1a;
            background: #ffffff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #000;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #000;
        }

        .breadcrumb {
            color: #666;
            margin-bottom: 1rem;
        }

        .breadcrumb a {
            color: #000;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        h2 {
            font-size: 1.8rem;
            margin: 2rem 0 1rem 0;
            color: #000;
            border-bottom: 1px solid #ccc;
            padding-bottom: 0.5rem;
        }

        h3 {
            font-size: 1.4rem;
            margin: 1.5rem 0 1rem 0;
            color: #000;
        }

        h4 {
            font-size: 1.2rem;
            margin: 1rem 0 0.5rem 0;
            color: #333;
        }

        p {
            margin-bottom: 1rem;
            color: #333;
        }

        pre {
            background: #f8f8f8;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        code {
            background: #f0f0f0;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
            font-size: 0.9em;
        }

        pre code {
            background: none;
            padding: 0;
        }

        .api-function {
            background: #f8f8f8;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .function-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .function-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #000;
            font-family: "Monaco", "Menlo", "Ubuntu Mono", monospace;
        }

        .function-type {
            background: #000;
            color: #fff;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .params-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .params-table th,
        .params-table td {
            border: 1px solid #ccc;
            padding: 0.6rem;
            text-align: left;
        }

        .params-table th {
            background: #e8e8e8;
            font-weight: 600;
        }

        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffecb5;
            color: #856404;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }

        .nav-section {
            background: #f8f8f8;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .nav-link {
            display: block;
            padding: 0.8rem;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
            text-align: center;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            background: #000;
            color: #fff;
            border-color: #000;
        }

        footer {
            text-align: center;
            padding: 2rem;
            border-top: 2px solid #000;
            margin-top: 3rem;
            color: #666;
        }

        footer a {
            color: #000;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            .function-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="breadcrumb">
                <a href="./index.html">Developer Docs</a> > API Reference
            </div>
            <h1>ðŸ“š API Reference</h1>
            <p>Complete API documentation for all functions, methods, and Firebase operations</p>
        </header>

        <div class="nav-section">
            <h3>Quick Navigation</h3>
            <div class="nav-grid">
                <a href="#firebase-operations" class="nav-link">Firebase Operations</a>
                <a href="#utility-functions" class="nav-link">Utility Functions</a>
                <a href="#type-definitions" class="nav-link">Type Definitions</a>
                <a href="#pwa-api" class="nav-link">PWA API</a>
                <a href="#chart-functions" class="nav-link">Chart Functions</a>
                <a href="#ai-integration" class="nav-link">AI Integration</a>
            </div>
        </div>

        <div class="info">
            <strong>API Conventions:</strong> All Firebase operations are async and return Promises. Error handling is built into each function with proper logging and user feedback.
        </div>

        <h2 id="firebase-operations">Firebase Operations</h2>

        <h3>Expense Operations</h3>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">addExpenseToFirestore</div>
                <div class="function-type">Async Function</div>
            </div>
            
            <p><strong>Purpose:</strong> Add a new expense to Firestore</p>
            
            <h4>Signature</h4>
            <pre><code>addExpenseToFirestore(
  userId: string, 
  expense: Omit&lt;Expense, 'id'&gt;
): Promise&lt;void&gt;</code></pre>

            <h4>Parameters</h4>
            <table class="params-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>userId</code></td>
                        <td><code>string</code></td>
                        <td>Yes</td>
                        <td>Authenticated user's ID</td>
                    </tr>
                    <tr>
                        <td><code>expense</code></td>
                        <td><code>Omit&lt;Expense, 'id'&gt;</code></td>
                        <td>Yes</td>
                        <td>Expense data without ID (auto-generated)</td>
                    </tr>
                </tbody>
            </table>

            <h4>Example Usage</h4>
            <pre><code>const newExpense = {
  amount: 50.00,
  category: "Food",
  description: "Lunch at restaurant",
  date: "2025-08-23",
  createdAt: new Date().toISOString(),
  peopleIds: ["person-id-1", "person-id-2"]
};

try {
  await addExpenseToFirestore(user.uid, newExpense);
  toast.success("Expense added successfully");
} catch (error) {
  console.error("Failed to add expense:", error);
  toast.error("Failed to add expense");
}</code></pre>

            <h4>Throws</h4>
            <ul>
                <li><code>FirebaseError</code> - Network or permission issues</li>
                <li><code>Error</code> - Validation errors</li>
            </ul>
        </div>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">updateExpenseInFirestore</div>
                <div class="function-type">Async Function</div>
            </div>
            
            <p><strong>Purpose:</strong> Update an existing expense in Firestore</p>
            
            <h4>Signature</h4>
            <pre><code>updateExpenseInFirestore(
  userId: string,
  expenseId: string,
  updates: Partial&lt;Expense&gt;
): Promise&lt;void&gt;</code></pre>

            <h4>Parameters</h4>
            <table class="params-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>userId</code></td>
                        <td><code>string</code></td>
                        <td>Yes</td>
                        <td>Authenticated user's ID</td>
                    </tr>
                    <tr>
                        <td><code>expenseId</code></td>
                        <td><code>string</code></td>
                        <td>Yes</td>
                        <td>ID of expense to update</td>
                    </tr>
                    <tr>
                        <td><code>updates</code></td>
                        <td><code>Partial&lt;Expense&gt;</code></td>
                        <td>Yes</td>
                        <td>Fields to update (partial object)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">subscribeToExpenses</div>
                <div class="function-type">Subscription Function</div>
            </div>
            
            <p><strong>Purpose:</strong> Subscribe to real-time expense updates</p>
            
            <h4>Signature</h4>
            <pre><code>subscribeToExpenses(
  userId: string,
  callback: (expenses: Expense[]) => void
): Unsubscribe</code></pre>

            <h4>Parameters</h4>
            <table class="params-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>userId</code></td>
                        <td><code>string</code></td>
                        <td>Yes</td>
                        <td>Authenticated user's ID</td>
                    </tr>
                    <tr>
                        <td><code>callback</code></td>
                        <td><code>(expenses: Expense[]) => void</code></td>
                        <td>Yes</td>
                        <td>Function called with updated expenses</td>
                    </tr>
                </tbody>
            </table>

            <h4>Returns</h4>
            <p><code>Unsubscribe</code> - Function to call to stop subscription</p>

            <h4>Example Usage</h4>
            <pre><code>useEffect(() => {
  if (!user?.uid) return;

  const unsubscribe = subscribeToExpenses(user.uid, (expenses) => {
    setExpenses(expenses);
    console.log('Received expenses update:', expenses.length);
  });

  // CRITICAL: Clean up subscription
  return () => {
    if (unsubscribe) unsubscribe();
  };
}, [user?.uid]);</code></pre>
        </div>

        <h3>Storage Operations</h3>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">uploadReceipt</div>
                <div class="function-type">Async Function</div>
            </div>
            
            <p><strong>Purpose:</strong> Upload receipt image to Firebase Storage</p>
            
            <h4>Signature</h4>
            <pre><code>uploadReceipt(
  userId: string,
  file: File
): Promise&lt;{ url: string; fileName: string }&gt;</code></pre>

            <h4>Parameters</h4>
            <table class="params-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>userId</code></td>
                        <td><code>string</code></td>
                        <td>Yes</td>
                        <td>Authenticated user's ID</td>
                    </tr>
                    <tr>
                        <td><code>file</code></td>
                        <td><code>File</code></td>
                        <td>Yes</td>
                        <td>Image file to upload</td>
                    </tr>
                </tbody>
            </table>

            <h4>Returns</h4>
            <p>Object with <code>url</code> (download URL) and <code>fileName</code> (original filename)</p>

            <h4>Validation</h4>
            <ul>
                <li>Maximum file size: 10MB</li>
                <li>Allowed types: image/jpeg, image/png, image/gif, image/webp</li>
                <li>User must be authenticated</li>
            </ul>
        </div>

        <h2 id="utility-functions">Utility Functions</h2>

        <h3>Data Processing Functions</h3>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">getAllPeople</div>
                <div class="function-type">Pure Function</div>
            </div>
            
            <p><strong>Purpose:</strong> Combine custom and public people data consistently</p>
            
            <h4>Signature</h4>
            <pre><code>getAllPeople(
  customPeople: Person[],
  publicPeople: Person[]
): Person[]</code></pre>

            <h4>Implementation</h4>
            <pre><code>export const getAllPeople = (
  customPeople: Person[] = [],
  publicPeople: Person[] = []
): Person[] => {
  const customIds = new Set(customPeople.map(p => p.id));
  const uniquePublicPeople = publicPeople.filter(p => !customIds.has(p.id));
  return [...customPeople, ...uniquePublicPeople];
};</code></pre>

            <h4>Usage Pattern</h4>
            <pre><code>// REQUIRED pattern for people data consistency
const allPeople = getAllPeople(customPeople, publicPeople);
const selectedPeopleData = selectedPeople.map(id => 
  allPeople.find(person => person.id === id)
).filter(Boolean);</code></pre>
        </div>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">getExpensesByDateRange</div>
                <div class="function-type">Pure Function</div>
            </div>
            
            <p><strong>Purpose:</strong> Filter expenses by date range</p>
            
            <h4>Signature</h4>
            <pre><code>getExpensesByDateRange(
  expenses: Expense[],
  dateRange: DateRange
): Expense[]</code></pre>

            <h4>Parameters</h4>
            <table class="params-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>expenses</code></td>
                        <td><code>Expense[]</code></td>
                        <td>Array of expenses to filter</td>
                    </tr>
                    <tr>
                        <td><code>dateRange</code></td>
                        <td><code>DateRange</code></td>
                        <td>Date range with from and to dates</td>
                    </tr>
                </tbody>
            </table>

            <h4>Example Usage</h4>
            <pre><code>const currentMonthExpenses = getExpensesByDateRange(expenses, {
  from: new Date(2025, 7, 1), // August 1, 2025
  to: new Date(2025, 7, 31)   // August 31, 2025
});</code></pre>
        </div>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">calculateCategorySpending</div>
                <div class="function-type">Pure Function</div>
            </div>
            
            <p><strong>Purpose:</strong> Calculate total spending per category</p>
            
            <h4>Signature</h4>
            <pre><code>calculateCategorySpending(
  expenses: Expense[]
): Record&lt;string, number&gt;</code></pre>

            <h4>Returns</h4>
            <p>Object mapping category names to total spending amounts</p>

            <h4>Example Usage</h4>
            <pre><code>const categorySpending = calculateCategorySpending(expenses);
// Result: { "Food": 450.50, "Transport": 120.00, "Entertainment": 80.25 }</code></pre>
        </div>

        <h2 id="type-definitions">Type Definitions</h2>

        <h3>Core Interfaces</h3>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">Expense</div>
                <div class="function-type">Interface</div>
            </div>
            
            <pre><code>interface Expense {
  id: string;                    // Auto-generated document ID
  amount: number;                // Expense amount (positive number)
  category: string;              // Category name
  description: string;           // Expense description
  date: string;                  // Expense date (YYYY-MM-DD format)
  createdAt: string;            // Creation timestamp (ISO string)
  receiptUrl?: string;          // Firebase Storage URL for receipt
  receiptFileName?: string;     // Original filename of receipt
  peopleIds?: string[];         // Array of person IDs for shared expenses
}</code></pre>
        </div>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">Person</div>
                <div class="function-type">Interface</div>
            </div>
            
            <pre><code>interface Person {
  id: string;                   // Auto-generated document ID
  name: string;                 // Person's display name
  color: string;               // Hex color for UI representation
  icon: string;                // Icon identifier (lucide icon name)
  userId: string;              // Creator's user ID
  isPublic: boolean;           // Whether shared publicly
  createdAt: string;           // Creation timestamp (ISO string)
  createdBy: string;           // Creator's display name
  relationship?: string;       // Optional: Family, Friend, Colleague, etc.
}</code></pre>
        </div>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">DateRange</div>
                <div class="function-type">Interface</div>
            </div>
            
            <pre><code>interface DateRange {
  from: Date;                  // Start date (inclusive)
  to: Date;                    // End date (inclusive)
}</code></pre>
        </div>

        <h2 id="pwa-api">PWA API</h2>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">PWAManager.checkForVersionUpdate</div>
                <div class="function-type">Async Method</div>
            </div>
            
            <p><strong>Purpose:</strong> Check if app update is available</p>
            
            <h4>Signature</h4>
            <pre><code>checkForVersionUpdate(): Promise&lt;{
  hasUpdate: boolean;
  isForceUpdate: boolean;
} | null&gt;</code></pre>

            <h4>Returns</h4>
            <ul>
                <li><code>null</code> - No update available</li>
                <li><code>{ hasUpdate: true, isForceUpdate: false }</code> - Optional update</li>
                <li><code>{ hasUpdate: true, isForceUpdate: true }</code> - Required update</li>
            </ul>

            <h4>Example Usage</h4>
            <pre><code>import { pwaManager } from '@/lib/pwa';

const checkForUpdates = async () => {
  const updateStatus = await pwaManager.checkForVersionUpdate();
  
  if (updateStatus?.hasUpdate) {
    if (updateStatus.isForceUpdate) {
      // Show non-dismissible update modal
      setUpdateType('force');
    } else {
      // Show optional update notification
      setUpdateType('available');
    }
  }
};</code></pre>
        </div>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">PWAManager.forceAppUpdate</div>
                <div class="function-type">Async Method</div>
            </div>
            
            <p><strong>Purpose:</strong> Force app update with cache clearing</p>
            
            <h4>Signature</h4>
            <pre><code>forceAppUpdate(): Promise&lt;void&gt;</code></pre>

            <h4>Process</h4>
            <ol>
                <li>Clear all browser caches</li>
                <li>Clear localStorage and sessionStorage</li>
                <li>Send SKIP_WAITING message to service worker</li>
                <li>Reload the application</li>
            </ol>
        </div>

        <h2 id="chart-functions">Chart Functions</h2>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">Chart Lifecycle Pattern</div>
                <div class="function-type">Pattern</div>
            </div>
            
            <p><strong>Purpose:</strong> Proper ApexCharts lifecycle management in React</p>
            
            <h4>Critical Implementation</h4>
            <pre><code>// REQUIRED pattern for ApexCharts in React
const [chartKey, setChartKey] = useState(0);
const chartInstanceRef = useRef&lt;ApexCharts | null&gt;(null);

// Force re-render on tab change
const handleTabChange = (value: string) => {
  setActiveTab(value);
  if (value === 'overview') {
    setChartKey(prev => prev + 1); // CRITICAL for chart visibility
  }
};

// Chart cleanup and initialization
useEffect(() => {
  // Clean up existing instance
  if (chartInstanceRef.current) {
    chartInstanceRef.current.destroy();
    chartInstanceRef.current = null;
  }
  
  // Initialize new chart
  if (activeTab === 'overview' && chartContainerRef.current) {
    const chart = new ApexCharts(chartContainerRef.current, chartOptions);
    chart.render();
    chartInstanceRef.current = chart;
  }
}, [activeTab, chartKey, data]);

// Chart container with unique key
&lt;div 
  key={`chart-${chartKey}`} 
  ref={chartContainerRef} 
  className="chart-container"
/&gt;</code></pre>

            <div class="warning">
                <strong>Critical:</strong> Never skip the chartKey increment - charts will disappear on tab switches!
            </div>
        </div>

        <h2 id="ai-integration">AI Integration</h2>

        <div class="api-function">
            <div class="function-header">
                <div class="function-name">BudgetAnalyzer Pattern</div>
                <div class="function-type">Component Pattern</div>
            </div>
            
            <p><strong>Purpose:</strong> AI-powered budget analysis with multiple fallbacks</p>
            
            <h4>Fallback Strategy</h4>
            <pre><code>const analyzeSpending = async () => {
  setLoading(true);
  try {
    // 1. Try OpenAI API
    const analysis = await callOpenAIDirectly(prompt);
    setAnalysis(JSON.parse(analysis));
  } catch (openAIError) {
    try {
      // 2. Fallback to Spark AI
      const analysis = await callSparkAI(prompt);
      setAnalysis(analysis);
    } catch (sparkError) {
      // 3. Fallback to statistical analysis
      const analysis = generateStatisticalAnalysis(expenses, budgets);
      setAnalysis(analysis);
    }
  } finally {
    setLoading(false);
  }
};</code></pre>

            <h4>Statistical Fallback</h4>
            <pre><code>const generateStatisticalAnalysis = (expenses: Expense[], budgets: Budget[]) => {
  const totalSpending = expenses.reduce((sum, exp) => sum + exp.amount, 0);
  const totalBudget = budgets.reduce((sum, budget) => sum + budget.limit, 0);
  
  return {
    summary: `Spent ${formatCurrency(totalSpending)} out of ${formatCurrency(totalBudget)} budget`,
    recommendations: [
      "Review high spending categories",
      "Consider setting stricter budget limits",
      "Track receipts for better expense categorization"
    ],
    insights: {
      budgetUtilization: totalBudget > 0 ? (totalSpending / totalBudget) * 100 : 0,
      topCategories: getTopSpendingCategories(expenses),
      trends: calculateSpendingTrends(expenses)
    }
  };
};</code></pre>
        </div>

        <div class="info">
            <strong>API Usage Guidelines:</strong>
            <ul>
                <li>Always handle async operations with proper try-catch blocks</li>
                <li>Validate user authentication before Firebase operations</li>
                <li>Use TypeScript interfaces for all function parameters and returns</li>
                <li>Implement proper loading and error states in components</li>
                <li>Clean up subscriptions and chart instances on component unmount</li>
                <li>Follow the established patterns for data consistency</li>
            </ul>
        </div>

        <footer>
            <p>&copy; 2025 Budget Buddy Developer Documentation | 
               <a href="./index.html">Back to Index</a> | 
               <a href="./components.html">Components</a> |
               <a href="./firebase.html">Firebase</a>
            </p>
            <p>Last Updated: August 23, 2025 | Version 2.5.5</p>
        </footer>
    </div>
</body>
</html>
